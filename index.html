<!DOCTYPE html>
<html>

<head>

</head>

<body>
    <form id="form" action="">
        <input id="input" autocomplete="off" /><button>Send</button>
    </form>
    <form id="" action="">
        <button id="create">Create room</button>
    </form>
    <form id="" action="">
        <button id="start" disabled>Start game</button>
    </form>
    <div style="margin-top:30px;">
        <label for="roomfield">Room id:</label>
        <input id="roomfield" autocomplete="off" disabled/>
        <label for="secretfield">Secret:</label>
        <input id="secretfield" autocomplete="off" disabled/>
    </div>
    <script src="/socket.io/socket.io.js"></script>

    <script>
        String.prototype.noSlash = function () {
            return this.replace(/\//g, '')
        }

        var socket = io();

        var messages = document.getElementById('messages');
        var form = document.getElementById('form');
        var create = document.getElementById('create');
        var start = document.getElementById('start');
        var input = document.getElementById('input');
        var roomField = document.getElementById('roomfield');
        var secretField = document.getElementById('secretfield');


        const path = window.location.pathname;
        const joinRoom = path.noSlash();
        // socket.emit('join room', room);
        form.addEventListener('submit', function (e) {
            e.preventDefault();
            if (input.value) {
                socket.emit('chat message', input.value);
                input.value = '';
            }
        });
        create.addEventListener('click', function (e) {
            e.preventDefault();
            socket.emit('create room', null);
        });
        start.addEventListener('click', function (e) {
            e.preventDefault();
            if(room.room){
                socket.emit('create room', room.room);
            }
        });
        socket.on('countdown', function (msg) {
            console.log(msg);
        });

        socket.on('round', function (msg) {
            console.log(msg);
        });

        socket.on('finished', function (msg) {
            console.log(msg);
        });
        let room;
        socket.on('room created', function (msg) {
            room = msg;
            roomField.value = room.room;
            secretField.value = room.secret;
            console.log(room)
            start.disabled = false;
        });

        socket.on('chat message', function (msg) {
            var item = document.createElement('li');
            item.textContent = msg;
            messages.appendChild(item);
            window.scrollTo(0, document.body.scrollHeight);
        });
    </script>
</body>

</html>